<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<title>Private Pro Chat</title>

<style>
body{
  margin:0;
  background:#1e1f22;
  font-family:Arial;
  color:#dcddde;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.app{
  width:900px;
  height:520px;
  background:#313338;
  border-radius:8px;
  display:flex;
  overflow:hidden;
}
.sidebar{
  width:240px;
  background:#2b2d31;
  padding:10px;
}
.user{
  padding:6px;
  border-radius:4px;
  cursor:pointer;
}
.user:hover{background:#3f4147}
.chat{
  flex:1;
  display:flex;
  flex-direction:column;
}
.messages{
  flex:1;
  padding:10px;
  overflow-y:auto;
}
.msg{
  margin-bottom:6px;
  display:flex;
  justify-content:space-between;
}
.name{font-weight:bold}
.trash{cursor:pointer;color:#ed4245;margin-left:8px}
.input{
  padding:10px;
  background:#383a40;
  display:flex;
}
.input input{
  flex:1;
  background:#1e1f22;
  border:none;
  color:#fff;
  padding:8px;
  border-radius:4px;
}
.input button{
  margin-left:8px;
  background:#5865f2;
  border:none;
  color:white;
  padding:8px 14px;
  border-radius:4px;
  cursor:pointer;
}
.adminPanel{
  border-top:1px solid #3f4147;
  padding:8px;
}
.adminPanel input, .adminPanel button{
  width:100%;
  margin-top:6px;
  padding:6px;
}
.red{background:#ed4245;color:white;border:none}
.green{background:#22c55e;color:black;border:none}
</style>
</head>

<body>

<div class="app">

<div class="sidebar">
  <h4>Users</h4>
  <div id="userList"></div>

  <div class="adminPanel" id="adminPanel" style="display:none">
    <input id="searchUser" placeholder="User adƒ±">
    <button class="red" onclick="deleteUser()">User sil</button>
    <button class="green" onclick="toggleAdmin()">Admin ver / al</button>
  </div>
</div>

<div class="chat">
  <div class="messages" id="messages"></div>
  <div class="input">
    <input id="msg" placeholder="Mesaj yaz..."
      onkeydown="if(event.key==='Enter')sendMessage()">
    <button onclick="sendMessage()">G√∂nd…ôr</button>
  </div>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ===== CONFIG ===== */
const CONFIG={
  adminUsername:"Huseyn(Qurucu)",
  defaultUsers:{
    "Huseyn(Qurucu)":{password:"14659445",role:"admin"},
    "Ferit":{password:"12345",role:"user"},
    "Rahim":{password:"12345",role:"user"}
  },
  firebase:{
    apiKey:"AIzaSyC4t6Cu-q8iIHGy3V5g-Q14s3qnwsnfRKU",
    databaseURL:"https://projectchat-bcb6e-default-rtdb.firebaseio.com"
  }
};

firebase.initializeApp(CONFIG.firebase);
const db=firebase.database();

/* ===== DEFAULT USERS (1 d…ôf…ô) ===== */
Object.keys(CONFIG.defaultUsers).forEach(u=>{
  db.ref("users/"+u).set(CONFIG.defaultUsers[u]);
});

let currentUser=CONFIG.adminUsername;
let currentRole="admin";

/* ===== USER LIST ===== */
db.ref("users").on("value",s=>{
  userList.innerHTML="";
  s.forEach(u=>{
    const d=document.createElement("div");
    d.className="user";
    d.innerText=u.key+" ("+u.val().role+")";
    userList.appendChild(d);
  });
});

if(currentRole==="admin"){
  adminPanel.style.display="block";
}

/* ===== ADMIN ACTIONS ===== */
function deleteUser(){
  const u=searchUser.value.trim();
  if(!u||u===CONFIG.adminUsername) return;
  db.ref("users/"+u).remove();
}

function toggleAdmin(){
  const u=searchUser.value.trim();
  if(!u) return;
  db.ref("users/"+u+"/role").get().then(s=>{
    const r=s.val()==="admin"?"user":"admin";
    db.ref("users/"+u+"/role").set(r);
  });
}

/* ===== CHAT ===== */
function sendMessage(){
  const t=msg.value.trim();
  if(!t) return;
  db.ref("messages").push({
    user:currentUser,
    role:currentRole,
    text:t
  });
  msg.value="";
}

db.ref("messages").on("child_added",s=>{
  const m=s.val();
  const id=s.key;

  const d=document.createElement("div");
  d.className="msg";
  d.id=id;

  const left=document.createElement("div");
  left.innerHTML=`<span class="name">${m.user}:</span> ${m.text}`;
  d.appendChild(left);

  if(m.user===currentUser || currentRole==="admin"){
    const tr=document.createElement("span");
    tr.className="trash";
    tr.innerText="üóëÔ∏è";
    tr.onclick=()=>db.ref("messages/"+id).remove();
    d.appendChild(tr);
  }

  messages.appendChild(d);
  messages.scrollTop=messages.scrollHeight;
});

db.ref("messages").on("child_removed",s=>{
  const el=document.getElementById(s.key);
  if(el) el.remove();
});
</script>

</body>
</html>
