<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<title>Gizli Dost Chat</title>

<style>
body{
  background:#0f172a;color:#e5e7eb;font-family:Arial;
  display:flex;justify-content:center;align-items:center;height:100vh
}
.box{background:#020617;width:380px;padding:20px;border-radius:10px}
input,button{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:none}
button{background:#22c55e;font-weight:bold;cursor:pointer}
#chatBox{
  height:220px;background:#020617;border:1px solid #1e293b;
  margin-top:10px;overflow-y:auto;padding:10px
}
.msg{
  margin-bottom:6px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.name{font-weight:bold}
.text{margin-left:6px}
.trash{
  cursor:pointer;
  color:#ef4444;
  margin-left:8px;
  font-size:14px;
}
</style>
</head>

<body>

<div class="box">
<h3 id="title">üîê Gizli Chat</h3>

<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Parol">
<button onclick="login()">Daxil ol</button>

<div id="chat" style="display:none">
  <div id="chatBox"></div>
  <input id="message" placeholder="Mesaj yaz..."
    onkeydown="if(event.key==='Enter')sendMessage()">
  <button onclick="sendMessage()">G√∂nd…ôr</button>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ===== CONFIG ===== */
const CONFIG={
  adminUsername:"Huseyn(Qurucu)",
  firebase:{
    apiKey:"AIzaSyC4t6Cu-q8iIHGy3V5g-Q14s3qnwsnfRKU",
    databaseURL:"https://projectchat-bcb6e-default-rtdb.firebaseio.com"
  }
};

firebase.initializeApp(CONFIG.firebase);
const db=firebase.database();

let currentUser="";
let userColors={};

/* üé® RANDOM COLOR */
function getColor(user){
  if(userColors[user]) return userColors[user];
  const colors=["#22c55e","#38bdf8","#facc15","#f472b6","#a78bfa","#fb7185"];
  const c=colors[Math.floor(Math.random()*colors.length)];
  userColors[user]=c;
  return c;
}

/* üîë LOGIN */
function login(){
  const u=username.value.trim();
  const p=password.value.trim();
  if(!u||!p) return alert("Bo≈ü buraxma");

  db.ref("users/"+u).get().then(s=>{
    if(!s.exists()) return alert("User yoxdur");
    if(s.val().password!==p) return alert("Parol s…ôhv");

    currentUser=u;
    username.style.display="none";
    password.style.display="none";
    document.querySelector("button").style.display="none";
    title.innerText="Xo≈ü g…ôldin, "+u;
    chat.style.display="block";
    listenMessages();
  });
}

/* üì§ SEND */
function sendMessage(){
  const t=message.value.trim();
  if(!t) return;

  db.ref("messages").push({
    user:currentUser,
    text:t,
    time:Date.now()
  });
  message.value="";
}

/* üóëÔ∏è DELETE MESSAGE */
function deleteMessage(id){
  db.ref("messages/"+id).remove();
}

/* üì• REAL-TIME */
function listenMessages(){
  chatBox.innerHTML="";
  db.ref("messages").on("child_added",s=>{
    const m=s.val();
    const id=s.key;

    const div=document.createElement("div");
    div.className="msg";

    const left=document.createElement("div");
    left.innerHTML=
      `<span class="name" style="color:${getColor(m.user)}">
       ${m.user}:</span>
       <span class="text">${m.text}</span>`;

    div.appendChild(left);

    if(m.user===currentUser){
      const trash=document.createElement("span");
      trash.className="trash";
      trash.innerText="üóëÔ∏è";
      trash.onclick=()=>deleteMessage(id);
      div.appendChild(trash);
    }

    div.id=id;
    chatBox.appendChild(div);
    chatBox.scrollTop=chatBox.scrollHeight;
  });

  db.ref("messages").on("child_removed",s=>{
    const el=document.getElementById(s.key);
    if(el) el.remove();
  });
}
</script>

</body>
</html>
