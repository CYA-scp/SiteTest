<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<title>Gizli Dost Chat</title>

<style>
body{
  background:#0f172a;color:#e5e7eb;font-family:Arial;
  display:flex;justify-content:center;align-items:center;height:100vh
}
.box{background:#020617;width:380px;padding:20px;border-radius:10px}
input,button{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:none}
button{background:#22c55e;font-weight:bold;cursor:pointer}
#chatBox{
  height:200px;background:#020617;border:1px solid #1e293b;
  margin-top:10px;overflow-y:auto;padding:10px
}
.msg{margin-bottom:6px}
.user{color:#facc15;font-weight:bold}
.me{color:#22c55e}
#adminPanel{border-top:1px solid #1e293b;margin-top:12px;padding-top:10px}
</style>
</head>

<body>

<div class="box">
<h3 id="title">üîê Gizli Chat Giri≈üi</h3>

<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Parol">
<button onclick="login()">Daxil ol</button>

<div id="chat" style="display:none">
  <div id="chatBox"></div>

  <input id="message" placeholder="Mesaj yaz..."
    onkeydown="if(event.key==='Enter')sendMessage()">
  <button onclick="sendMessage()">G√∂nd…ôr</button>

  <div id="adminPanel" style="display:none">
    <h4>üëë Admin Panel</h4>
    <input id="newUser" placeholder="Yeni username">
    <input id="newPass" placeholder="Yeni parol">
    <button onclick="addUser()">User …ôlav…ô et</button>
  </div>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ===================================================
   ‚öôÔ∏è AYARLAR ‚Äì YALNIZ BURANI D∆èYƒ∞≈û
=================================================== */
const CONFIG = {
  adminUsername: "Huseyn(Qurucu)",

  // ilk userl…ôr (Firebase-…ô avtomatik yazƒ±lacaq)
  defaultUsers: {
    "Huseyn(Qurucu)": "14659445",
    "Ferit": "12345",
    "Rahim": "12345"
  },

  firebase: {
    apiKey: "AIzaSyC4t6Cu-q8iIHGy3V5g-Q14s3qnwsnfRKU",
    databaseURL: "https://projectchat-bcb6e-default-rtdb.firebaseio.com"
  }
};
/* =================================================== */

firebase.initializeApp(CONFIG.firebase);
const db = firebase.database();
let currentUser = "";

/* üîπ DEFAULT USERLARI YARAT (1 D∆èF∆è) */
Object.keys(CONFIG.defaultUsers).forEach(u=>{
  db.ref("users/"+u).set({ password: CONFIG.defaultUsers[u] });
});

/* üîë LOGIN */
function login(){
  const u = username.value.trim();
  const p = password.value.trim();
  if(!u || !p) return alert("Bo≈ü buraxma");

  db.ref("users/"+u).get().then(s=>{
    if(!s.exists()) return alert("User yoxdur ‚ùå");
    if(s.val().password !== p) return alert("Parol s…ôhvdir ‚ùå");

    currentUser = u;
    username.style.display = "none";
    password.style.display = "none";
    document.querySelector("button").style.display = "none";

    title.innerText = "Xo≈ü g…ôldin, " + u;
    chat.style.display = "block";

    if(u === CONFIG.adminUsername){
      adminPanel.style.display = "block";
    }

    listenMessages();
  });
}

/* ‚ûï ADMIN ‚Üí USER ∆èLAV∆è ET */
function addUser(){
  const u = newUser.value.trim();
  const p = newPass.value.trim();
  if(!u || !p) return alert("Bo≈ü buraxma");

  db.ref("users/"+u).set({ password: p });
  alert("User …ôlav…ô olundu ‚úÖ");
  newUser.value = "";
  newPass.value = "";
}

/* üì§ MESAJ G√ñND∆èR */
function sendMessage(){
  const t = message.value.trim();
  if(!t) return;

  db.ref("messages").push({
    user: currentUser,
    text: t,
    time: Date.now()
  });
  message.value = "";
}

/* üì• REAL-TIME */
function listenMessages(){
  chatBox.innerHTML = "";
  db.ref("messages").limitToLast(100)
    .on("child_added", s=>{
      const m = s.val();
      const d = document.createElement("div");
      d.className = "msg";
      d.innerHTML =
        `<span class="user ${m.user===currentUser?'me':''}">
         ${m.user}:</span> ${m.text}`;
      chatBox.appendChild(d);
      chatBox.scrollTop = chatBox.scrollHeight;
    });
}
</script>

</body>
</html>
